{"version":3,"sources":["cbody.js","util.js","app.js"],"names":["CBody","pos","vel","mass","color","a","x","y","F","dt","w","h","static","c","fillStyle","beginPath","arc","Math","PI","fill","closePath","dist","vdist","abs","op","b","dx","dy","sqrt","v","_","G","System","canvas","document","querySelector","width","documentElement","scrollWidth","height","scrollHeight","getContext","font","trail","resetBodies","mouse","vx","vy","time","performance","now","addEventListener","click","bind","mousemove","keyup","quadratic","fps","timer","counter","current","_loop","loop","window","requestAnimationFrame","gui","dat","GUI","add","trailGui","staticGui","onChange","toggleStatic","bodies","updateDisplay","fillRect","blen","length","i","dead","splice","update","draw","j","d","dabs","Fabs","pow","applyForce","big","small","e","clientX","clientY","push","random","undefined","key","app"],"mappings":"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","file":"app.c98d0bb6.map","sourceRoot":"..","sourcesContent":["/**\r\n * Stands for \"Celestial Body\"...\r\n */\r\n\r\nexport default class CBody {\r\n  constructor(pos, vel, mass, color) {\r\n    this.pos = pos;\r\n    this.vel = vel;\r\n    this.a = { x: 0, y: 0 };\r\n    this.mass = mass;  // Mass == Radius\r\n    this.color = color;\r\n  }\r\n\r\n  applyForce(F) {\r\n    this.a.x += F.x;\r\n    this.a.y += F.y;\r\n  }\r\n\r\n  update(dt, w, h) {\r\n    if (this.static) return;\r\n\r\n    this.vel.x += dt * this.a.x / this.mass;\r\n    this.vel.y += dt * this.a.y / this.mass;\r\n\r\n    this.pos.x += this.vel.x * dt;\r\n    this.pos.y += this.vel.y * dt;\r\n\r\n         if (this.pos.x < -this.mass)  this.pos.x = w + this.mass;\r\n    else if (this.pos.x > this.mass+w) this.pos.x = -this.mass;\r\n         if (this.pos.y < -this.mass)  this.pos.y = h + this.mass;\r\n    else if (this.pos.y > this.mass+h) this.pos.y = -this.mass;\r\n\r\n    this.a.x = 0; this.a.y = 0;\r\n  }\r\n\r\n  draw(c) {\r\n    c.fillStyle = this.color;\r\n    c.beginPath();\r\n    c.arc(this.pos.x, this.pos.y, this.mass, 0, 2.0*Math.PI);\r\n    c.fill();\r\n    c.closePath();\r\n  }\r\n}","export function dist(a, b) {\r\n  let dx = a.x-b.x;\r\n  let dy = a.x-b.y;\r\n  return Math.sqrt(dx*dx + dy*dy);\r\n}\r\n\r\nexport function vdist(a, b) {\r\n  return { x: b.x-a.x, y: b.y-a.y };\r\n}\r\n\r\nexport function abs(v) {\r\n  return Math.sqrt(v.x*v.x + v.y*v.y);\r\n}\r\n\r\nexport function op(v) {\r\n  return { x: -v.x, y: -v.y };\r\n}","import CBody from \"./cbody\"\r\nimport * as _ from \"./util\"\r\n\r\n//-- Some constants --//\r\nlet G = 1000; // Yay! Made up values!\r\n\r\nclass System {\r\n  constructor() {\r\n    //-- Canvas stuff --//\r\n    this.canvas = document.querySelector('#canvas');\r\n    this.canvas.width = this.width = document.documentElement.scrollWidth;\r\n    this.canvas.height = this.height = document.documentElement.scrollHeight;\r\n    this.c = this.canvas.getContext('2d');\r\n    this.c.font = '12px \"Source Code Pro\", monospace';\r\n    this.trail = true;\r\n\r\n    // Start with a single body in the middle\r\n    this.resetBodies();\r\n\r\n    //-- Initialize mouse stuff --//\r\n    this.mouse = {\r\n      x: 0, y: 0,\r\n      vx: 0, vy: 0,\r\n      time: performance.now()\r\n    };\r\n    this.canvas.addEventListener('click', this.click.bind(this));\r\n    this.canvas.addEventListener('mousemove', this.mousemove.bind(this));\r\n    this.canvas.addEventListener('touchmove', this.mousemove.bind(this));\r\n    this.canvas.addEventListener('touchend', this.click.bind(this));\r\n\r\n    //-- Keyup... --//\r\n    document.addEventListener('keyup', this.keyup.bind(this));\r\n\r\n    //-- Physics --//\r\n    this.quadratic = 1;\r\n\r\n    //-- Starting loop --//\r\n    this.dt = .1;\r\n    this.fps = { timer: 0, counter: 0, current: 0 };\r\n    this.time = performance.now();\r\n    this._loop = this.loop.bind(this);\r\n    window.requestAnimationFrame(this._loop);\r\n\r\n    //-- Dat.GUI --//\r\n    this.gui = new dat.GUI();\r\n    this.fps.gui = this.gui.add(this, 'FPS');\r\n    this.trailGui = this.gui.add(this, 'trail');\r\n    this.static = false;\r\n    this.staticGui = this.gui.add(this, 'static').onChange(this.toggleStatic.bind(this));\r\n    this.gui.add(this, 'resetBodies');\r\n  }\r\n\r\n  // Just for dat.GUI...\r\n  get FPS() { return this.fps.current; }\r\n  \r\n  resetBodies() {\r\n    this.bodies = [\r\n      new CBody(\r\n        { x: this.width/2.0, y: this.height/2.0 },\r\n        { x:0, y:0 },\r\n        10,\r\n        'white'\r\n      )\r\n    ];\r\n    this.static = false;\r\n    if (this.staticGui) this.staticGui.updateDisplay();\r\n  }\r\n  \r\n  loop(time) {\r\n    //-- Update timer stuff --//\r\n    let dt = (time - this.time)/1000.0;  \r\n    this.time = time;\r\n    \r\n    // Clear screen\r\n    // this.c.fillStyle = this.trail ? '#0b1c3810' : '#0b1c38';\r\n    this.c.fillStyle = this.trail ? 'rgba(0,0,0,.1)' : 'rgba(0,0,0,1)';\r\n    this.c.fillRect(0, 0, this.width, this.height);\r\n    \r\n    // Show FPS (updated each second)\r\n    this.fps.timer += dt;\r\n    this.fps.counter++;\r\n    if (this.fps.timer >= 1.0) {\r\n      this.fps.current = this.fps.counter;\r\n      this.fps.counter = 0; \r\n      this.fps.timer = 0;\r\n      this.fps.gui.updateDisplay();\r\n    }\r\n    // this.c.fillStyle = 'white';\r\n    // this.c.fillText(this.fps.current + ' FPS', 25, 25);\r\n\r\n    //-- Update & Draw all celestial bodies --//\r\n    let blen = this.bodies.length;  // Slight optimizations! Hurray!\r\n    for (let i = 0; i < blen; i++) {\r\n      // Remove the 'dead' body (damn) and continue the loop like nothing happened\r\n      if (this.bodies[i].dead) { this.bodies.splice(i, 1); i--; blen--; continue; }\r\n      \r\n      // Update 'em & draw 'em\r\n      this.bodies[i].update(dt, this.width, this.height);\r\n      this.bodies[i].draw(this.c);\r\n      \r\n      // Interactions between bodies\r\n      for (let j = i+1; j < blen; j++) {\r\n        if (this.bodies[j].dead) { continue; }\r\n\r\n        // Calculate distance. Both vectorial and scalar\r\n        let d = _.vdist(this.bodies[i].pos, this.bodies[j].pos);\r\n        let dabs = _.abs(d);\r\n        \r\n        // Gravitational force\r\n        let Fabs = ((this.quadratic ? 500*G : G) * this.bodies[i].mass * this.bodies[j].mass) / Math.pow(dabs, this.quadratic+2);\r\n        let F = { x: d.x*Fabs, y: d.y*Fabs };\r\n        this.bodies[i].applyForce(F);\r\n        this.bodies[j].applyForce(_.op(F));\r\n        \r\n        // Collision\r\n        if (dabs < this.bodies[i].mass + this.bodies[j].mass) {\r\n          // Choose which body is the bigger and which is the smaller one\r\n          let big, small;\r\n          if (this.bodies[i].mass > this.bodies[j].mass) { big = this.bodies[i]; small = this.bodies[j]; }\r\n          else { big = this.bodies[j]; small = this.bodies[i]; }\r\n          \r\n          // The big one 'absorbs' the small's mass, whilst the small one dies a horrible death\r\n          big.mass += small.mass;\r\n          small.dead = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    window.requestAnimationFrame(this._loop);\r\n  }\r\n\r\n  mousemove(e) {\r\n    let now = performance.now();\r\n    let dt = (now - this.mouse.time) / 1000.0;\r\n\r\n    this.mouse.vx = (e.clientX - this.mouse.x) / dt;\r\n    this.mouse.vy = (e.clientY - this.mouse.y) / dt;\r\n\r\n    this.mouse.time = now;\r\n    this.mouse.x = e.clientX;\r\n    this.mouse.y = e.clientY;\r\n  }\r\n\r\n  click(e) {\r\n    let v;\r\n    if (performance.now() - this.mouse.time > 150) { // More than 150 ms have passed since the last mousemove\r\n      v = { x: 0, y: 0 };\r\n    } else {\r\n      v = { x: this.mouse.vx, y: this.mouse.vy };\r\n    }\r\n\r\n    this.bodies.push(new CBody(\r\n      { x: e.clientX, y: e.clientY },\r\n      v, \r\n      4,\r\n      `hsl(${Math.random()*360}, 80%, 75%)`\r\n    ));\r\n  }\r\n\r\n  toggleStatic(v) {\r\n    this.bodies[0].pos = { x: this.width/2.0, y: this.height/2.0 };\r\n    this.bodies[0].vel = { x: 0, y: 0 };\r\n    this.bodies[0].a = { x: 0, y: 0 };\r\n    this.bodies[0].static = v !== undefined ? v : !this.bodies[0].static;\r\n    this.static = this.bodies[0].static;\r\n  }\r\n\r\n  keyup(e) {\r\n    if (e.key === 'r') {\r\n      this.resetBodies();\r\n    } else if (e.key === 's') {\r\n      this.toggleStatic();\r\n      this.staticGui.updateDisplay();\r\n    } else if (e.key === 't') {\r\n      this.trail = !this.trail; \r\n      this.trailGui.updateDisplay();\r\n    } else if (e.key === 'q') {\r\n      this.quadratic = 1 - this.quadratic;\r\n    }\r\n  }\r\n\r\n}\r\n\r\nwindow.app = new System();\r\n\r\n"]}